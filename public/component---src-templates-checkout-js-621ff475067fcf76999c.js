(self.webpackChunkgatsby_starter_default=self.webpackChunkgatsby_starter_default||[]).push([[222],{9686:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var n=a(7294),l=a(1715),r=a(5444);var s,i,c=a(3026),o=function(){var e=(0,n.useContext)(l.sA);function t(){return e.items?e.items.reduce((function(e,t){return e+t.count*t.price}),0):0}return console.log(e),n.createElement(n.Fragment,null,n.createElement("div",{className:"mb-3"},n.createElement("div",{className:"resultPrice mb-3"},e.items&&e.items.length>0&&n.createElement(n.Fragment,null,n.createElement("div",{className:"pb-3"},n.createElement("strong",null,"ВАШ ЗАКАЗ:")),n.createElement("div",{className:"row  pb-3 d-flex align-items-center"},n.createElement("div",{className:"col"},n.createElement("span",null,"Товаров на сумму:")),n.createElement("div",{className:"col-auto"},n.createElement("div",{className:"box-result"},t()," грн"))),n.createElement("div",{className:"row line-bottom  pb-3 d-flex align-items-center"},n.createElement("div",{className:"col"},n.createElement("span",null,"Ваша скидка:")),n.createElement("div",{className:"col-auto"},n.createElement("div",{className:"box-result"},"0 грн"))),n.createElement("div",{className:"row  pt-3 d-flex align-items-center"},n.createElement("div",{className:"col"},n.createElement("span",null,"Сумма к оплате:")),n.createElement("div",{className:"col-auto"},n.createElement("div",{className:"box-result"},t()," грн")))))))},m=a(3552),d=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),l=0;l<a;l++)n[l]=arguments[l];return(t=e.call.apply(e,[this].concat(n))||this).state={firstName:"",lastName:"",phone:"",city:"",address1:""},t.handleInputChange=function(e){var a,n=e.target,l=n.value,r=n.name;t.setState(((a={})[r]=l,a))},t.handleSubmit=function(e){e.preventDefault(),t.props.setStep(3),"undefined"!=typeof window&&localStorage.setItem("payment",JSON.stringify(t.state)),console.log("payment","undefined"!=typeof window&&JSON.parse(localStorage.getItem("payment")))},t}(0,m.Z)(t,e);var a=t.prototype;return a.componentDidMount=function(){var e="undefined"!=typeof window&&JSON.parse(localStorage.getItem("payment"));e&&this.setState({firstName:e.firstName||"",lastName:e.lastName||"",phone:e.phone||"",city:e.city||"",address1:e.address1||""})},a.render=function(){return n.createElement("form",{onSubmit:this.handleSubmit},n.createElement("div",{className:"box-checkout-title text-center"},n.createElement("strong",null,"получатель")),n.createElement("div",{id:"payment",className:"payment line-bottom pt-3 pb-3"},n.createElement("div",{className:"input-group"},n.createElement("input",{required:!0,type:"text",name:"firstName",placeholder:"Имя",className:0==this.state.firstName.length?"input error":"input valid",value:this.state.firstName,onChange:this.handleInputChange})),n.createElement("div",{className:"input-group"},n.createElement("input",{required:!0,type:"text",name:"lastName",placeholder:"Фамилия",className:"input",value:this.state.lastName,onChange:this.handleInputChange})),n.createElement("div",{className:"input-group"},n.createElement("input",{required:!0,type:"phone",name:"phone",placeholder:"Ваш телефон",className:"input",value:this.state.phone,onChange:this.handleInputChange}))),n.createElement("div",{className:"box-checkout-title text-center pt-3"},n.createElement("strong",null,"адрес получения")),n.createElement("div",{id:"delivery",className:"delivery pt-3 pb-3"},n.createElement("div",{className:"input-group"},n.createElement("input",{required:!0,type:"text",name:"city",placeholder:"Город",className:"input",value:this.state.city,onChange:this.handleInputChange})),n.createElement("div",{className:"input-group"},n.createElement("input",{required:!0,type:"text",name:"address1",placeholder:"Выберите отделение новой почты",className:"input",value:this.state.address1,onChange:this.handleInputChange})),n.createElement("div",{className:"input-group"},n.createElement("button",{className:"btn style-3 w100"},"Продолжить"))))},t}(n.Component),u=a(2137),p=a(5761),g=a(7757),h=a.n(g),v=a(103),N=a(2863),E=a(778),f=(0,a(908).Ps)(s||(s=(0,p.Z)(["\n    query MyQuery {\n      paymentGateways(where: {all: false}) {\n        edges {\n          node {\n            id\n            title\n            description\n          }\n          cursor\n        }\n      }\n    }\n"]))),y=function(){var e=(0,E.useQuery)(f),t=e.loading,a=e.error,l=e.data;return t?'<option value="">...Загрузка</option>':a?'<option value=""> Error! '+a.message+" </option>":("undefined"!=typeof window&&localStorage.setItem("paymentGateways",JSON.stringify(l.paymentGateways.edges)),n.createElement(n.Fragment,null,n.createElement("option",{value:""},"Выберите способ оплаты"),l.paymentGateways.edges.map((function(e){return n.createElement("option",{value:e.node.id},e.node.title)}))))},x=(0,v.ZP)(i||(i=(0,p.Z)(["\n    mutation createOrderMutation( $clientMutationId: String!, $firstName: String!,$lastName: String!, $phone: String!, $city: String!, $address1: String!, $lineItems: [LineItemInput], $paymentMethod: String!, $paymentMethodTitle: String! ){\n    createOrder(input: {clientMutationId: $clientMutationId, billing: {firstName: $firstName, lastName: $lastName, phone: $phone, city: $city, address1: $address1}, isPaid: false , lineItems: $lineItems, paymentMethod: $paymentMethod, paymentMethodTitle: $paymentMethodTitle }) {\n      clientMutationId \n      order {\n        id\n        billing {\n          firstName\n          lastName\n          phone\n          city\n          address1\n        }\n        paymentMethod\n        paymentMethodTitle\n      }\n      orderId\n    }\n  }\n"]))),b=function(e){var t=(0,n.useContext)(l.sA),a=(0,n.useState)(""),s=a[0],i=a[1];return n.createElement(n.Fragment,null,n.createElement("div",{className:"pay pt-3 pb-3"},n.createElement(N.mm,{mutation:x},(function(a,l){var c=l.loading,o=(l.error,l.data);return n.createElement(n.Fragment,null,n.createElement("form",{onSubmit:function(){var n=(0,u.Z)(h().mark((function n(l){var r;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:l.preventDefault(),e.setStep(3),r="undefined"!=typeof window&&JSON.parse(localStorage.getItem("payment")),console.log("firstName",r,r.firstName),a({variables:{clientMutationId:"Checkout",firstName:r.firstName,lastName:r.lastName,phone:r.phone,city:r.city,address1:r.address1,lineItems:t.items.map((function(e){return{variationId:e.databaseId,quantity:e.count}})),paymentMethod:s.value,paymentMethodTitle:s[s.selectedIndex].text}}),"undefined"!=typeof window&&JSON.parse(localStorage.getItem("payment")),console.log("payMetodValue.selectedIndex",s.selectedIndex),"undefined"!=typeof window&&localStorage.setItem("payMetodIndex",JSON.stringify(s.selectedIndex));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},n.createElement("div",{className:"input-group"},n.createElement("select",{required:!0,size:"1",className:"input",name:"payMetod",onChange:function(e){i(e.target),console.log("payMetodValue",e.target.value,e.target.selectedIndex,e.target[e.target.selectedIndex].text)}},n.createElement(y,null))),n.createElement("div",{className:"text-center"},n.createElement("button",{className:"btn style-3 w100"},c?"Отправка...":"подтвердить заказ"," "))),n.createElement("div",{className:"d-none"},o&&n.createElement(n.Fragment,null,console.log("form send ",o),"data.createOrder.orderId && (","undefined"!=typeof window&&localStorage.setItem("lastOrder",JSON.stringify(o)),"undefined"!=typeof window&&localStorage.setItem("AddCart",""),(0,r.navigate)("/order"),")")))})),n.createElement("div",{className:"text text-center pt-4 pb-1"},"Нажимая кнопку “оформить покупку/оплатить”, я подтверждаю согласие с условиями  ",n.createElement(r.Link,{className:"btn style-6",to:"/"}," электронного договора купли-продажи товаров  ")),n.createElement("div",{className:"text-center mt-2"},n.createElement("button",{onClick:function(){return e.setStep(2)},className:"box-svg"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"10",viewBox:"0 0 14 10"},n.createElement("g",null,n.createElement("g",null,n.createElement("path",{fill:"#888",d:"M4.997 9.663l.94-.94-3.054-3.06h10.78V4.33H2.883l3.06-3.06-.946-.94L.33 4.997z"})))),n.createElement("span",{className:"btn style-6 ml-1"},"Назад к доставке")))))},w=a(3441),S=function(e){var t,a,r=e.pageContext,s="undefined"!=typeof window&&JSON.parse(localStorage.getItem("AddCart")),i=(0,n.useState)(2),m=i[0],u=i[1];return n.createElement(l.ZP,{page:"checkout"},n.createElement(w.Z,{title:r.title}),s&&s.length>0?n.createElement("div",{className:"container pt-1"},n.createElement("div",{className:"box-checkout-list row"},n.createElement("div",{id:"box-checkout-list-2",className:"list-item col "+(null!==(t=1===m)&&void 0!==t?t:"active")},"Доставка"),n.createElement("div",{id:"box-checkout-list-3",className:"list-item col "+(null!==(a=2===m)&&void 0!==a?a:"active")},"Оплата")),n.createElement("div",{className:"box-checkout-result"},2===m&&n.createElement("div",{id:"box-checkout-list-2-result",className:"result active"},n.createElement("div",{className:"col-12"},n.createElement(d,{setStep:u}))),3===m&&n.createElement("div",{id:"box-checkout-list-3-result",className:"result active"},n.createElement("div",{className:"box-checkout-title text-center pt-3"},n.createElement("strong",null,"Оплата")),n.createElement(b,{setStep:u}))),n.createElement(o,null)):n.createElement(c.Z,{info:"save",title:"Корзина пустая",text:"Вы не добавили в корзину ни одного товара",classBox:"h-100 ",homeBtn:!0}))}}}]);
//# sourceMappingURL=component---src-templates-checkout-js-621ff475067fcf76999c.js.map